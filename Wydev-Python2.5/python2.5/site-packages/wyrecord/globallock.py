# -*- coding: utf-8 -*- 
#
# Description:
#
# WyRecord Global Lock Class Definition
#
#
#
# Changes:
#
# 2014-03-26
# Initial Commit
#
#
# Copyright 2010-2014, WyDev Team.
# Author: Polo35 (polo35580@hotmail.fr)
#
# Licenced under Academic Free License version 3.0
# Review WyGui README & LICENSE files for further details.


from threading import Lock
from peewee.debug import GET_LOGGER, PRINT_EXCEPTION


wyrecord_global_lock = Lock()

log = GET_LOGGER(__name__)


# WyRecord Alloc Decorator
class GlobalLock(object):

	def __init__(self):
		return None

	def __call__(self, f):
		def manage_wyrecord_lock(*args, **kwds):
			wyrecord_global_lock.acquire()
			try:
				f_result = f(*args, **kwds)
			except Exception, e:
				wyrecord_global_lock.release()
				PRINT_EXCEPTION(e)
				raise e
			wyrecord_global_lock.release()
			return f_result

		return manage_wyrecord_lock
