# -*- coding: utf-8 -*- 
#
# Description:
#
# Player Entry Point Definition
#
#
#
# Changes:
#
# 2011-10-25
# Initial Commit
#
#
#
# Copyright 2010-2012, WyDev Team.
# Author: Polo35 (polo35580@hotmail.fr)
#
# Licenced under Academic Free License version 3.0
# Review WyGui README & LICENSE files for further details.


from __future__ import absolute_import

from peewee.debug import GET_LOGGER, PRINT_EXCEPTION
from pygui.config import user_config, plugins
from pygui.shared import pygui_globs
import pygui.config as config

log = GET_LOGGER(__name__)


forward_tricks_icons = {0: 'ff1', 1: 'ff2', 2: 'ff3', 3: 'ff4', 4: 'ff5', 5: 'ff5', 6: 'ff5', 7: 'ff5', 8: 'ff5', 9: 'ff5', 10: 'ff5'}
backward_tricks_icons = {0: 'bw1', 1: 'bw2', 2: 'bw3', 3: 'bw4', 4: 'bw5', 5: 'bw5', 6: 'bw5', 7: 'bw5', 8: 'bw5', 9: 'bw5', 10: 'bw5'}


log.info('Loading players...')

if config.no_PLAYERS:
	AudioPlayer = None
	VideoPlayer = None
	TVPlayer = None
	DVDPlayer = None
	ChannelScanner = None
	ImageViewer = None
	WebBrowser = None
else:
	try:
		from pygui.facilities.subtitles import SubServer
		subserver = SubServer()
	except:
		subserver = None
		log.warning("unable to instancy Subserver. Subtitles Won't be displayed !")
	pygui_globs['subserver'] = subserver
#	try:
	from pygui.menu.players.audio_player import AudioPlayer
	log.debug('Audio Player loaded')
#	except Exception, e:
#		AudioPlayer = None
#		log.error('Audio Player loading error: %s', str(e))
	try:
		from pygui.menu.players.video_player import VideoPlayer
		log.debug('Video Player loaded')
	except Exception, e:
		VideoPlayer = None
		log.error('Video Player loading error: %s', str(e))
	try:
		from wyrecord import WyRecord
		wr = WyRecord()
		wr.setMaximumTimeshiftDuration((user_config['tv']['timeshift_length'] * 60))
		wr.setRecordPadding((user_config['tv']['epg_margin'] * 60))

		def _on_record_event(*args, **kw):
			from pygui.facilities.wylight import WyLed
			if wr.scheduler.IsSomeRecordingRunning():
				WyLed().ask_led_action(1)
			else:
				WyLed().ask_led_action(25)
			return None

		wr.callbacks.recording_event.register(_on_record_event)
		from pygui.item.parameters.tv import wyscanserver
		wyscan = wyscanserver()
		from pygui.menu.players.tv_player import TVPlayer
		log.debug('TV Player loaded')
	except Exception, e:
		TVPlayer = None
		pygui_globs['record_manager'] = None
		PRINT_EXCEPTION()
		log.error('TV Player loading error: %s', str(e))
	try:
		from pygui.menu.players.dvd_player import DVDPlayer
		log.debug('DVD Player loaded')
	except Exception, e:
		DVDPlayer = None
		PRINT_EXCEPTION()
		log.error('DVD Player loading error: %s', str(e))
	from pygui.menu.players.image_viewer import ImageViewer
	try:
		from pygui.menu.players.channelscanner import ChannelScanner
		log.debug('Channel Scanner loaded')
	except Exception, e:
		ChannelScanner = None
		log.error('Channel Scanner loading error: %s', str(e))
	try:
		from pygui.menu.players.web_browser import WebBrowser
		log.debug('Web Browser loaded')
	except Exception, e:
		WebBrowser = None
		log.error('Web Browser loading error: %s', str(e))
log.info('Players loaded!')

	