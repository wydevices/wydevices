# -*- coding: utf-8 -*- 
#
# Description:
#
# Greetings Parameters Menu Class Definition
#
#
#
# Changes:
#
# 2011-10-02
# Initial Commit
#
# 2011-10-04
# Modify event handling trick to exit menu with left button
#
#
# Copyright 2010-2012, WyDev Team.
# Author: Polo35 (polo35580@hotmail.fr)
#
# Licenced under Academic Free License version 3.0
# Review WyGui README & LICENSE files for further details.


from itertools import count
from pygui.menu.menu.core import Menu
from peewee.messages import send
from peewee.notifier import Task
from peewee.debug import PRINT_EXCEPTION



class LicenseMenu(Menu):

	def __init__(self, *args, **kw):
		if 'type' not in kw:
			kw['type'] = 'scroller'
		filename = kw.pop('filename')
		self.fd = file(filename)
		Menu.__init__(self, *args, **kw)
		self._getitems_keywords['full_text'] = (lambda : '')
		default_evt = self.eventhandler.event_home
		for evt in 'wheel_rwd wheel_fwd right up down select toggle_menu action_menu record stop info marker'.split():
			setattr(self.eventhandler, 'event_' + evt, default_evt)
		self.eventhandler.event_down = (lambda ev: self._next_item())
		Task(self._next_item).start(0.29999999999999999)
		return None

	def stop(self):
		self.fd.close()
		Menu.stop(self)
		return None

	def _next_item(self):
		send('on_scroll', sender=self)
		vals = []
		l = None
		try:
			while True:
				l = self.fd.readline()
				if not l or l == '\\n\n':
					break
				vals.append(l)
		except:
			PRINT_EXCEPTION()
			self.hide()
		txt = ''.join(vals)
		if not txt:
			self.hide()
		else:
			Task(send, 'full_text', sender=self, value=txt).start(1)
		return None
