# -*- coding: utf-8 -*- 
#
# Description:
#
#  Definition of Menu Cursor
#
#
#
# Changes:
#
# 2014-03-24
# Initial Commit
#
#
# Copyright 2010-2014, WyDev Team.
# Author: Polo35 (polo35580@hotmail.fr)
#
# Licenced under Academic Free License version 3.0
# Review WyGui README & LICENSE files for further details.

from peewee.messages import send
from pygui import config

DISPLAY_WIDTH = config.display_width
DISPLAY_HEIGHT = config.display_height

# A cursor that can move on the screen.
#
# To use it:
# - in the menu constructor:
#     self._cursor = Cursor()
#     self._getitems_keywords['cursor'] = lambda: None
# 
# - in the menu's event_handler:
#     def event_mouse(self, event):
#         arg = event.arg
#         self.player._cursor.set_absolute(arg["x"], arg["y"], self.player)
# 
# - in the menu's skin:
#     <cursor name="cursor" height="2%" width="2%">
#         <image layer="10" hcenter="0%" vcenter="0%" file="/path/cursor.png"
#                preserve_aspect="true" keep_real_size="true" />
#     </cursor>
class Cursor(object):

	__slots__ = '_target_zone'

	# @param target_zone: 4-float tuple (xmin, xmax, ymin, ymax).
	def __init__(self, target_zone=None):
		self._target_zone = target_zone

	# Move the cursor to the x, y coordinates (absolute).
	# x and y are scaled to the target zone.
	def set_absolute(self, x, y, player):
		x = float(x) / 100.0 * DISPLAY_WIDTH
		y = float(y) / 100.0 * DISPLAY_HEIGHT
		target_zone = self._target_zone
		if target_zone is not None:
			xmin, xmax, ymin, ymax = target_zone
			a = (xmax - xmin) / DISPLAY_WIDTH
			b = xmin
			x = int(a * x + b)
			a = (ymax - ymin) / DISPLAY_HEIGHT
			b = ymin
			y = int(a * y + b)
		else:
			x = int(x)
			y = int(y)
		send('cursor', action='send_mouse', sender=player, x=x, y=y)
		return None



