# -*- coding: utf-8 -*- 
#
# Description:
#
# TV Parameters Items Entry Point
#
#
#
# Changes:
#
# 2012-04-12
# Initial Commit
#
#
# Copyright 2010-2014, WyDev Team.
# Author: Polo35 (polo35580@hotmail.fr)
#
# Licenced under Academic Free License version 3.0
# Review WyGui README & LICENSE files for further details.


from __future__ import absolute_import

from peewee.debug import PRINT_EXCEPTION, DEBUG, GET_LOGGER
from peewee.misc_utils import MetaSingleton
from pygui.item.containers import GenericContainer
from pygui.item.core import Item
from pygui.item.parameters import ParametersSetupItem

import pygui.config as config

log = GET_LOGGER(__name__)



class _WyScanServerWrap(object):

	__metaclass__ = MetaSingleton
	
	def __init__(self):
		self.wyscanserver = None
		if 'tv' in config.plugins:
			from WyScan import WYScanServer
			self.wyscanserver = WYScanServer(strBusName='com.wyplay.wyscan', strPathName='/com/wyplay/WyScan', strWyDbusInstanceName='com.wydbus.wyscan_4_gui')
		else:
			log.debug("WyScanServer can't be found, tv setup parameters are disabled.")
		return None



def wyscanserver():
	return _WyScanServerWrap().wyscanserver

def getitem(menu):
	if wyscanserver() is None:
		return None
	return TVSetupParametersItem(_('TV'), 'tv', display_type='setup_tv', menu=menu)



class TVSetupParametersItem(GenericContainer):

	def browse(self, preview=False):
		from pygui.item.parameters.tv.tvsetup import EPGMarginItem, TNTScanMenuSetupItem, ExternalAntenna
		return [EPGMarginItem('tv', 'epg_margin', config.HMI_TV['epg_margins'], 'Time record margins', type_='setupitem'), TNTScanMenuSetupItem('Channel search', type_='setupitem', menu=self.menu), ExternalAntenna('tv', 'lnb_high_voltage', (True, False), 'External antenna', type_='setupitem')]

	def update_name(self):
		self._name = _('TV')
		return None
