# -*- coding: utf-8 -*- 
#
# Description:
#
# Hand Actions Youtube Jobs Class and Decorators Definitions
#
#
#
# Changes:
#
# 2011-10-16
# Initial Commit
#
# 2012-01-07
# Add user and search saving to "/etc/search.cfg" file
# 
#
# Copyright 2010-2012, WyDev Team.
# Author: Polo35 (polo35580@hotmail.fr)
#
# Licenced under Academic Free License version 3.0
# Review WyGui README & LICENSE files for further details.


from peewee.messages import send as louie_send
from pygui.facilities.codemapping import youtube_format_dict
from pygui.facilities.l10n import UnicodeDict
from pygui.facilities.searchsave import YoutubeConfig
from pygui.item.containers import ActionContainer
from pygui.window import ConfirmWindow
from pygui.shared import pygui_globs


# Youtube video format choice item
class ChangeYoutubeVideoFormatItem(ActionContainer):
	
	def __init__(self, name, item, menu, **kw):
		self.item = item
		self.item.media_update()
		self.actions_dict = dict()
		ActionContainer.__init__(self, name=name, type_='action', menu=menu, **kw)
		self.radio = True
		pos = 0
		for format in self.item.available_formats:
			caption = youtube_format_dict.get(int(format), str(format))
			self.actions_dict[format] = dict(handler=self.set_youtube_format, caption=caption, checked=self.item.choosen_format == format, pos=pos, args=(format,), kwargs=dict())
			pos += 1

	def set_youtube_format(self, format):
		self._update_checked(format)
		self.item.choosen_format = format
		self.menu._set_options_list(keep_selection=True)


# Remove a user from youtube config file.
def execute_del_youtube_user(context):
	item = context['selected']
	YoutubeConfig().DelUser(item.name)
	context['parent']._items = None
	pygui_globs['menustack'].back_to_menu(context['menu'])
	context['menu'].reload_func()
	return None


# Remove a search from youtube config file.
def execute_del_youtube_search(context):
	item = context['selected']
	YoutubeConfig().DelSearch(item.name)
	context['parent']._items = None
	pygui_globs['menustack'].back_to_menu(context['menu'])
	context['menu'].reload_func()
	return None
