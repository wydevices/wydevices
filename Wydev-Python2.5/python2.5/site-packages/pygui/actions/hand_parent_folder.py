# -*- coding: utf-8 -*- 
#
# Description:
#
# Actions Hand Parent Folder Class Definition
#
#
#
# Changes:
#
# 2014-04-07
# Initial Commit
#
#
# Copyright 2010-2014, WyDev Team.
# Author: Polo35 (polo35580@hotmail.fr)
#
# Licenced under Academic Free License version 3.0
# Review WyGui README & LICENSE files for further details.


from __future__ import absolute_import

name = 'Parentfolder'
position = 3
image = 'hand_parent'
category = 'navigator'
default = False
unique = False

from pygui.actions.jobs.common import push_thumbnail_menu
from pygui.actions.jobs.fs import execute_mkdir
from pygui.actions.jobs.marker import execute_copy_marked_items
from pygui.config import user_config
from pygui.item.core import ActionItem
from pygui.item.mediaitem.core import RootItem
from pygui.item.mediaitem.tv import TVRootItem
from pygui.shared import pygui_globs
from pygui.markerlist import actions, markerlists
from pygui.menu import menu


def is_available(context):
	if context['parent'] not in (None, RootItem()):
		return context['menu'].type not in ('tv_navigator')
	return context['parent'] not in (None, RootItem())


def get_action_info_list(context):
	stack = pygui_globs['menustack']
	act = []
	fl = markerlists().get(context['menu'].universe)
	if context['menu'].type in ('image', 'video', 'video_image'):
		menu_video_photo = True
	else:
		menu_video_photo = False
	if context['menu'].type in ('audio',):
		menu_music = True
	else:
		menu_music = False
	if isinstance(stack.menus_stack[-2], menu.MarkerNavigator):
		for stack_layer in reversed(stack.menus_stack):
			if isinstance(stack_layer, menu.Navigator) and not isinstance(stack_layer, menu.MarkerNavigator):
				break
		if stack_layer:
			act.append(ActionItem(_('Display'), type_='action', action=(lambda : stack.back_to_menu(stack_layer))))
	if (menu_music or menu_video_photo) and (user_config['security']['parent_mode'] or not user_config['security']['parental_control']):
		if context['parent']['backend'] != 'upnp':
			act.append(ActionItem(_('Create a new folder'), type_='action', action=execute_mkdir, args=[context]))
	if fl and context['parent']['backend'] != 'upnp' and (user_config['security']['parent_mode'] or not user_config['security']['parental_control']):
		act.append(ActionItem(_('Duplicate marked item'), type_='action', action=execute_copy_marked_items, args=[context['parent'], fl]))
		for plugin_name in ('marker_create_playlist',):
			plugin = actions[plugin_name]
			act.append(ActionItem(_(plugin.caption), type_='action', action=plugin.execute, args=[context]))
	if menu_video_photo and any(('image' in it.type for it in context['menu'].get_item_list('main_list'))):
		act.append(ActionItem(_('Display "%s" as thumbnails') % context['parent'].name, type_='action', action=push_thumbnail_menu, args=(context, stack)))
	return act
