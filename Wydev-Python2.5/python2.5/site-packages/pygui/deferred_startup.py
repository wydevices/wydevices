# -*- coding: utf-8 -*- 
#
# Description:
#
# Deferred Startup Procedure
#
#
#
# Changes:
#
# 2011-10-02
# Remove WyPlay Update Method (not used)
# Remove BANZAI Plugin handling (not used)
#
#
# Copyright 2010-2012, WyDev Team.
# Author: Polo35 (polo35580@hotmail.fr)
#
# Licenced under Academic Free License version 3.0
# Review WyGui README & LICENSE files for further details.


from __future__ import absolute_import

from pygui.shared import pygui_globs
from peewee.debug import log, PRINT_EXCEPTION
from pygui.config import plugins, no_DBUS


####################################
# Deferred Startup
####################################
def init_startup():
	
	# Init WyDBUS
	if no_DBUS:
		pygui_globs['wydbus'] = None
	else:
		from peewee.dbus import peewee_dbus
		pygui_globs['wydbus'] = peewee_dbus
	
	# Init Root Item
	try:
		from pygui.item.mediaitem.core import RootItem
		RootItem()
	except:
		PRINT_EXCEPTION()
		log.error('Failed to load wymedia!')
	
	# Init Input
	try:
		import pygui.input as input
		input.init()
	except:
		PRINT_EXCEPTION()
		log.error('Failed to load input!')
	
	# Init Video Modes
	try:
		from pygui.facilities.videomodes import VideoModes
		vm = VideoModes()
	except:
		vm = None
		PRINT_EXCEPTION()
		log.error('Failed to load videomodes!')
	finally:
		pygui_globs['videomodes'] = vm

	# Init Players
	try:
		import pygui.menu.players
	except:
		PRINT_EXCEPTION()
		log.error('Failed to load players!')
	
	# Init Audio Mixer
	try:
		from pygui.facilities.mixer import Mix
		Mix()
	except:
		log.error('Failed to load audio mixer!')
		PRINT_EXCEPTION()
	
	# Init Screen Saver
	try:
		try:
			from pygui.menu.menu.screensaver import screensaver_dict
			from pygui.config import user_config
			saver = screensaver_dict[user_config['power']['screensaver_type']]()
		except:
			saver = None
			log.error('Failed to load screensaver!')
			PRINT_EXCEPTION()
	finally:
		pygui_globs['screensaver'] = saver

	# BANZAI !!! MDR !!!
	#if ('banzai' in plugins):
	#	from pygui.facilities.plugin.banzai import BanzaiPlugin
	#	BanzaiPlugin()
	
	# PSP
	if ('transcode' in plugins):
		pygui_globs['psp_path'] = None
