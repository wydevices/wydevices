# -*- coding: utf-8 -*- 
#
# Description:
#
# MarkerList Actions Delete Class Definition
#
#
#
# Changes:
#
# 2014-04-07
# Initial Commit
#
#
# Copyright 2010-2014, WyDev Team.
# Author: Polo35 (polo35580@hotmail.fr)
#
# Licenced under Academic Free License version 3.0
# Review WyGui README & LICENSE files for further details.


from __future__ import absolute_import

from peewee.debug import log, PRINT_EXCEPTION
from pygui.markerlist import get_marker_from_item, markerlists, marker_list_remove, get_root
from pygui.window import ConfirmWindow, MessageWindow, BigMessageWindow
from wymedia.wmplus import RemoveError, NotPermittedError

caption = 'Delete marked items'


def is_compatible(context):
	if context['parent_mode'] and context['menu'].type in ('video_image', 'audio', 'image', 'video', 'multiverse'):
		return True
	return False


# Delete all marked items (in fs too)
# Launch a ConfirmWindow
def execute(context):
	def __do_delete():
		fl = markerlists().get(context['menu'].universe)
		try:
			fl.vfs_delete()
		except RemoveError:
			PRINT_EXCEPTION()
			MessageWindow(text=_('Error removing %s') % 'markerlist', title=_('Error')).show(timeout=5)
		except NotPermittedError, e:
			PRINT_EXCEPTION()
			if e.message == 'NOT_SUPPORTED_BY_FS':
				BigMessageWindow(text=_('The way this disk was formatted does not allow this operation'), title=_('Error')).show(timeout=5)
			else:
				MessageWindow(text=_('Operation not permitted'), title=_('Error')).show(timeout=5)
		fl.clear()
		menu = context['menu']
		menu.reload_func()
		menu._update_marker()
		return None
	context['parent'].show_menu()
	win = ConfirmWindow(_('Are you sure ?'), confirm_action=__do_delete)
	win.show()
	if context['menu'] and hasattr(context['menu'], 'contextual_windows'):
		context['menu'].contextual_windows.append(win)
	return None
