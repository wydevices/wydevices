# -*- coding: utf-8 -*- 
#
# Description:
#
# MarkerList Actions Dup To Highlight Class Definition
#
#
#
# Changes:
#
# 2014-04-07
# Initial Commit
#
#
# Copyright 2010-2014, WyDev Team.
# Author: Polo35 (polo35580@hotmail.fr)
#
# Licenced under Academic Free License version 3.0
# Review WyGui README & LICENSE files for further details.


from __future__ import absolute_import

from WyRPC import WyXMLRPCProxy
from peewee.debug import log
from marker_dup_to_parent import process, GraphicalCopy
from pygui.markerlist import get_marker_from_item, IncompatibleMarkerlistDestination, markerlists


caption = 'Duplicate marked items into "%(highlighted_item)s"'


def is_compatible(context):
	try:
		if context['selected'].type in ('dir', 'disc', 'usb'):
			return context['menu'].type in ('video_image', 'video', 'image', 'audio', 'multiverse')
	except Exception, e:
		pass
	return False


def execute(context):
	if not is_compatible(context):
		raise IncompatibleMarkerlistDestination
	fl = markerlists().get(context['menu'].universe)
	if context['selected'].type in ('disc', 'dvd'):
		mountpoint = context['selected']['media'].mountpoint
		dir = context['selected'].filename.replace(mountpoint, '/', 1)
		burn_clt = WyXMLRPCProxy('/tmp/wy_burning')
		burn_clt.new_burning()
		burn_clt.set_burn_mode('data_cd')
		burn_clt.set_finalized(False)
		burn_clt.set_new_session(False)
		for item in fl.items:
			log.debug('Add to burnlist : %s' % item.filename)
			burn_clt.add_files(item.filename, dir)
	else:
		dst = context['selected'].filename
		process(GraphicalCopy(context['selected'], fl, dst))
	return None
