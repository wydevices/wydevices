# -*- coding: utf-8 -*- 
#
# Description:
#
# MarkerList Actions Create Playlist Class Definition
#
#
#
# Changes:
#
# 2014-04-07
# Initial Commit
#
#
# Copyright 2010-2014, WyDev Team.
# Author: Polo35 (polo35580@hotmail.fr)
#
# Licenced under Academic Free License version 3.0
# Review WyGui README & LICENSE files for further details.


from __future__ import absolute_import

from wymedia.wmplus import BrowseError, CreateContainerError, FilenameExistsError
from pygui.item.mediaitem import Playlist
from pygui.markerlist import markerlists

caption = 'Create a playlist with the marked items'


def is_compatible(context):
	return context['menu'].type in ('video_image', 'image', 'video', 'audio')

# Create a playlist from marked items.
# Launch a KeyboardWindow to get the playlist's name
def execute(context):
	from pygui.window import KeyboardWindow, MessageWindow
	mlist = markerlists().get(context['menu'].universe)
	def __create(k):
		name = k._text.strip()
		title = _("Can't use that name")
		if not name:
			message = _('That name is not valid. Choose another one.')
			MessageWindow(message, title, button=None).show(timeout=5)
			return None
		try:
			mlist.create_playlist(context['parent'], name)
		except CreateContainerError:
			MessageWindow(text=_('Error while creating playlist'), title=_('Error')).show(timeout=5)
		except FilenameExistsError:
			MessageWindow(text=_('Filename %s already exists') % name, title=title).show(timeout=5)
		k.hide()
		context['parent'].show_menu()
		return None
	name = context['parent'].get_free_child_name(_('Playlist'))
	kbd = KeyboardWindow(_('Playlist name'), text=name, confirm_action=__create)
	kbd.show()
	if context['menu'] and hasattr(context['menu'], 'contextual_windows'):
		context['menu'].contextual_windows.append(kbd)
	return None
