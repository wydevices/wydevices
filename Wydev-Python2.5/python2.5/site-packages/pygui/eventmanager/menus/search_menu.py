# -*- coding: utf-8 -*- 
#
# Description:
#
# EventManager Search Menu Class Definition
#
#
#
# Changes:
#
# 2014-04-07
# Initial Commit
#
#
# Copyright 2010-2014, WyDev Team.
# Author: Polo35 (polo35580@hotmail.fr)
#
# Licenced under Academic Free License version 3.0
# Review WyGui README & LICENSE files for further details.


from __future__ import absolute_import

from pygui.eventmanager import EventDispatcher
from pygui.markerlist import markerlists, Markerlist
from pygui.item.mediaitem import DirItem
from pygui.window import LoadingWindow
from pygui.eventmanager.menu.core import MenuEventHandler


class SearchMenuEventHandler(MenuEventHandler):
	
	def event_action_menu(self, event):
		self.player.hide()
		return True

	def event_select(self, event):
		self.player.execute_selected()
		return True

	def event_up(self, event):
		self._move(-event.arg['count'])
		return True

	def event_down(self, event):
		self.player.ask_pattern()
		return True

	def event_left(self, event):
		self._move(-event.arg['count'])
		return True

	def event_right(self, event):
		self._move(event.arg['count'])
		return True

	def event_marker(self, event):
		play = self.player.navigator
		sel = play.selected
		if sel is None:
			log.warning('Nothing to put in markerlist')
			return True
		if not isinstance(sel, Markerlist):
			marker = markerlists()[self.player.universe]
			if sel.is_marked():
				marker.del_item(sel)
			else:
				w = None
				if isinstance(sel, DirItem):
					w = LoadingWindow('')
					w.show()
				marker.add_item(sel)
				if w:
					w.hide()
		play._update_marker()
		return True
