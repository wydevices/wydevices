# -*- coding: utf-8 -*- 
#
# Description:
#
# Facilities Event Logger Class Definition
#
#
#
# Changes:
#
# 2014-04-07
# Initial Commit
#
#
# Copyright 2010-2014, WyDev Team.
# Author: Polo35 (polo35580@hotmail.fr)
#
# Licenced under Academic Free License version 3.0
# Review WyGui README & LICENSE files for further details.


from __future__ import absolute_import

from peewee import debug
from peewee.notifier import events_watch
from pygui.input.eventlogger import EventLogger

log = debug.GET_LOGGER(__name__)


# Eventlogger plugin is used to log events in one file
# it must be activated in local_conf.py or it won't be loaded.
class EventLoggerPlugin(object):

	def __init__(self):
		events_watch(self.handle)
		self.logger = EventLogger()
		return None

	def handle(self, event):
		self.logger.add(event)
		return None



# Debug plugin is used for enabling DEBUG mode.
# Active in debug versions only.
# 
# TODO Maybe think of a way to enable it from redist versions?
class DebugPlugin(object):

	def __init__(self):
		events_watch(self.handle)
		return None

	def handle(self, event):
		if event.name == 'DEBUG':
			if not debug.DEBUG_MODE:
				debug.DEBUG_MODE = True
				debug.CALLS_ONLY = True
			elif debug.CALLS_ONLY:
				debug.CALLS_ONLY = False
			else:
				debug.DEBUG_MODE = False
			log.debug('DEBUG=%s, only calls=%s', debug.DEBUG_MODE, debug.CALLS_ONLY)
		return None
