#!/bin/sh
# Start & stop samba-client

export LD_LIBRARY_PATH="/wymedia/usr/lib"
export PATH="/wymedia/usr/bin:$PATH"
export HOME="/wymedia"

DIRNAME="@ Samba Shares @"



case "$1" in
	start)
		if pidof fusesmb > /dev/null 2>&1; then
			echo "samba-client already running."
			exit 0
		fi
		echo -n "Starting samba-client..."
		mkdir -p /wymedia/.smb
		cp /wymedia/usr/etc/fusesmb.conf /wymedia/.smb
		chmod 600 /wymedia/.smb/fusesmb.conf
		mkdir -p "/wymedia/My Videos/$DIRNAME"
		mkdir -p "/wymedia/My Photos/$DIRNAME"
		mkdir -p "/wymedia/My Music/$DIRNAME"
		cd /wymedia/usr/bin
		fusesmb -s "/wymedia/My Videos/$DIRNAME"
		mount --bind "/wymedia/My Videos/$DIRNAME" "/wymedia/My Photos/$DIRNAME"
		mount --bind "/wymedia/My Videos/$DIRNAME" "/wymedia/My Music/$DIRNAME"
		echo ok
		;;
	stop)
		echo -n "Stopping samba-client..."
		umount "/wymedia/My Photos/$DIRNAME" 2> /dev/null
		umount "/wymedia/My Music/$DIRNAME" 2> /dev/null
		killall -q fusesmb
		umount "/wymedia/My Videos/$DIRNAME" 2> /dev/null
		rmdir "/wymedia/My Photos/$DIRNAME" 2> /dev/null
		rmdir "/wymedia/My Music/$DIRNAME" 2> /dev/null
		rmdir "/wymedia/My Videos/$DIRNAME" 2> /dev/null
		echo ok
		;;
	restart)
		$0 stop
		sleep 1
		$0 start
		;;
	status)
		if pidof fusesmb > /dev/null 2>&1; then
			echo "samba-client running"
		else
			echo "samba-client not running"
			exit 1
		fi
		;;
	*)
		echo "Usage: $0 {start|stop|restart|status}"
		exit 1
		;;
esac

exit 0
